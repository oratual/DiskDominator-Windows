<!DOCTYPE html>
<html>
<head>
<title>DiskDominator Debug Launcher</title>
<HTA:APPLICATION 
    ID="DiskDominatorDebug"
    APPLICATIONNAME="DiskDominator Debug"
    BORDER="dialog"
    CAPTION="yes"
    SHOWINTASKBAR="yes"
    SINGLEINSTANCE="yes"
    WINDOWSTATE="normal"
/>

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
}
.info {
    background: #f0f0f0;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
    font-family: 'Consolas', monospace;
}
.success { color: green; }
.error { color: red; }
button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 16px;
}
</style>

<script language="VBScript">
Option Explicit

Dim objShell, objFSO, strPath
Set objShell = CreateObject("WScript.Shell")
Set objFSO = CreateObject("Scripting.FileSystemObject")

Sub Window_OnLoad
    window.resizeTo 800, 600
    CheckEnvironment
End Sub

Sub CheckEnvironment
    Dim info, htaPath, currentDir
    
    ' Get HTA location
    htaPath = window.location.pathname
    htaPath = Replace(htaPath, "file:///", "")
    htaPath = Replace(htaPath, "/", "\")
    
    ' Get directory
    currentDir = objFSO.GetParentFolderName(htaPath)
    strPath = currentDir & "\"
    
    info = "<h2>Debug Information</h2>"
    info = info & "<div class='info'>HTA Path: " & htaPath & "</div>"
    info = info & "<div class='info'>Current Directory: " & strPath & "</div>"
    
    ' Check for package.json
    If objFSO.FileExists(strPath & "package.json") Then
        info = info & "<div class='info success'>✓ package.json found</div>"
    Else
        info = info & "<div class='info error'>✗ package.json NOT found at: " & strPath & "package.json</div>"
    End If
    
    ' Check for node_modules
    If objFSO.FolderExists(strPath & "node_modules") Then
        info = info & "<div class='info success'>✓ node_modules found</div>"
    Else
        info = info & "<div class='info error'>✗ node_modules NOT found</div>"
    End If
    
    ' Check Node.js
    Dim nodeVersion
    On Error Resume Next
    nodeVersion = objShell.Exec("cmd /c node --version").StdOut.ReadAll()
    On Error GoTo 0
    
    If Len(nodeVersion) > 0 Then
        info = info & "<div class='info success'>✓ Node.js installed: " & Trim(nodeVersion) & "</div>"
    Else
        info = info & "<div class='info error'>✗ Node.js NOT installed</div>"
    End If
    
    ' List files in directory
    info = info & "<h3>Files in directory:</h3><div class='info'>"
    Dim folder, file
    Set folder = objFSO.GetFolder(strPath)
    For Each file In folder.Files
        info = info & file.Name & "<br>"
        If Len(info) > 5000 Then
            info = info & "... (truncated)"
            Exit For
        End If
    Next
    info = info & "</div>"
    
    document.getElementById("info").innerHTML = info
End Sub

Sub StartApp
    If objFSO.FileExists(strPath & "package.json") Then
        objShell.Run "cmd /c cd /d """ & strPath & """ && npm run dev", 1, False
        document.getElementById("status").innerHTML = "<div class='success'>Server starting... Check http://localhost:3002</div>"
    Else
        document.getElementById("status").innerHTML = "<div class='error'>Cannot start: package.json not found!</div>"
    End If
End Sub
</script>
</head>

<body>
<h1>DiskDominator Debug Launcher</h1>
<div id="info">Loading...</div>
<button onclick="StartApp()">Start DiskDominator</button>
<div id="status"></div>
</body>
</html>